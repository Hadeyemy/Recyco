<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recyco Dashboard</title>
    
    <!-- Leaflet CSS -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-sA+4gRkkX0kjKscdThTL4WW2WoH4RG14D2F5JuKZ0jQ="
        crossorigin=""
    />

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: var(--primary-color);
            color: white;
            padding: 2rem;
        }

        .sidebar h2 {
            margin-bottom: 2rem;
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
        }

        .sidebar nav ul li {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .sidebar nav ul li.active {
            background: rgba(255, 255, 255, 0.2);
        }

        main {
            flex: 1;
            padding: 2rem;
            background: #f5f5f5;
        }

        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .card p {
            margin-bottom: 1rem;
            color: #666;
        }

        .card button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .card button:hover {
            background: var(--primary-dark);
        }

        /* Map container styling */
        #map {
            height: 250px;
            width: 100%;
            border-radius: 8px;
            margin-top: 0.75rem;
            box-shadow: var(--shadow);
        }

        /* Chart container styling */
        #metricsChart {
            max-width: 100%;
            height: 250px;
            margin-top: 0.75rem;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar">
            <h2>Recyco</h2>
            <nav>
                <ul>
                    <li id="user-tab" onclick="showSection('user')" class="active">User Dashboard</li>
                    <li id="admin-tab" onclick="showSection('admin')">Admin Dashboard</li>
                </ul>
            </nav>
        </aside>

        <main>
            <!-- USER DASHBOARD -->
            <section id="user" class="panel active">
                <h1>User Dashboard</h1>
                <div class="cards">
                    <div class="card">
                        <h2>Bin Stations</h2>
                        <p>Nearby bins around you based on your location.</p>
                        <div id="map"></div>
                        <button onclick="locateUser()">Find My Location</button>
                    </div>
                    <div class="card">
                        <h2>Materials</h2>
                        <p>Types of materials you've recycled (glass, paper, metals, etc.).</p>
                        <button onclick="alert('Loading material stats...')">View History</button>
                    </div>
                    <div class="card">
                        <h2>Metrics</h2>
                        <p>Completed pickups, missed pickups, and other stats.</p>
                        <canvas id="metricsChart"></canvas>
                    </div>
                    <div class="card">
                        <h2>Profile</h2>
                        <p>Your personal info and settings.</p>
                        <button onclick="alert('Opening profile...')">Edit Profile</button>
                    </div>
                </div>
            </section>

            <!-- ADMIN DASHBOARD -->
            <section id="admin" class="panel">
                <h1>Admin Dashboard</h1>
                <div class="cards">
                    <div class="card">
                        <h2>Bin Station Management</h2>
                        <p>Add/edit stations, view capacities, assign tasks.</p>
                        <button onclick="alert('Managing bin stations...')">Manage Bins</button>
                    </div>
                    <div class="card">
                        <h2>Materials Overview</h2>
                        <p>Track recycled materials and trends by region.</p>
                        <button onclick="alert('Loading material overview...')">View Reports</button>
                    </div>
                    <div class="card">
                        <h2>User Metrics</h2>
                        <p>Analyze user activity and pickup statistics.</p>
                        <button onclick="alert('Analyzing user metrics...')">Analyze Users</button>
                    </div>
                    <div class="card">
                        <h2>Admin Profile</h2>
                        <p>Manage your settings, credentials, and alerts.</p>
                        <button onclick="alert('Opening admin profile...')">Edit Admin</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Leaflet JS -->
    <script
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-o9N1j4MrCzUqDxb6AI3UB/vCSk0RVp4AzT3zMKU7CJo="
        crossorigin=""
    ></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        let map, userMarker;
        
        // Check user role on page load
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const role = urlParams.get('role');
            
            if (role === 'admin') {
                showSection('admin');
            } else {
                showSection('user');
            }
            
            initializeDashboard(role);
        });

        function initializeDashboard(role) {
            if (role === 'admin') {
                document.getElementById('user-tab').style.display = 'none';
                showSection('admin');
            } else {
                document.getElementById('admin-tab').style.display = 'none';
                showSection('user');
            }

            if (role === 'user') {
                initializeMap();
                initializeChart();
            }
        }

        function showSection(id) {
            document.querySelectorAll(".panel").forEach((p) => p.classList.remove("active"));
            document.getElementById(id).classList.add("active");
            highlightTab(id);

            if (id === "user") {
                if (!map) initializeMap();
                if (!window.metricsChart) initializeChart();
            }
        }

        function highlightTab(id) {
            document.querySelectorAll(".sidebar nav ul li").forEach((tab) => {
                tab.classList.remove("active");
            });
            document.getElementById(id + "-tab").classList.add("active");
        }

        function initializeMap() {
            if (map) return; // Prevent re-initializing

            // Default center (e.g. Lagos, Nigeria)
            map = L.map("map").setView([6.5244, 3.3792], 13);

            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                maxZoom: 19,
                attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            }).addTo(map);

            // Example bin stations markers
            const bins = [
                { name: "Bin Station 1", coords: [6.5244, 3.3792] },
                { name: "Bin Station 2", coords: [6.5200, 3.3900] },
                { name: "Bin Station 3", coords: [6.5300, 3.3700] },
            ];

            bins.forEach((bin) => {
                L.marker(bin.coords).addTo(map).bindPopup(bin.name);
            });
        }

        function locateUser() {
            if (!map) return alert("Map is not ready yet.");
            if (!navigator.geolocation) return alert("Geolocation is not supported by your browser.");

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const latlng = [pos.coords.latitude, pos.coords.longitude];
                    map.setView(latlng, 14);

                    if (userMarker) {
                        userMarker.setLatLng(latlng);
                    } else {
                        userMarker = L.marker(latlng, { title: "You are here" }).addTo(map).bindPopup("You are here").openPopup();
                    }
                },
                () => {
                    alert("Unable to retrieve your location.");
                }
            );
        }

        function initializeChart() {
            const ctx = document.getElementById("metricsChart").getContext("2d");

            window.metricsChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["Completed", "Incomplete", "Missed", "Scheduled"],
                    datasets: [
                        {
                            label: "Pickups Count",
                            data: [12, 3, 2, 7],
                            backgroundColor: [
                                "rgba(46, 125, 50, 0.7)",
                                "rgba(255, 193, 7, 0.7)",
                                "rgba(255, 82, 82, 0.7)",
                                "rgba(102, 187, 106, 0.7)",
                            ],
                            borderColor: [
                                "rgba(46, 125, 50, 1)",
                                "rgba(255, 193, 7, 1)",
                                "rgba(255, 82, 82, 1)",
                                "rgba(102, 187, 106, 1)",
                            ],
                            borderWidth: 1,
                            borderRadius: 5,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                            },
                        },
                    },
                    plugins: {
                        legend: {
                            display: false,
                        },
                    },
                },
            });
        }
    </script>
</body>
</html> 